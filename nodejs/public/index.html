<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KV Store Viewer</title>
    <link rel="stylesheet" href="styles.css?v=admin-update-1">
</head>
<body>
    
    <div class="container">
        <!-- Header Section -->
        <div class="header">
            <h1>KV Store Viewer</h1>
            <div class="status">
                <div class="status-indicator" id="statusIndicator"></div>
                <span id="statusText">Checking connection...</span>
            </div>
        </div>
        
        <!-- Tab Navigation -->
        <div class="tab-nav">
            <button class="tab-button active" onclick="showTab('browse')">Browse Data</button>
            <button class="tab-button" onclick="showTab('clear')">Clear Data</button>
        </div>
        
        <!-- Browse Data Tab -->
        <div id="browseTab" class="tab-content active">
                <!-- Controls Section -->
        <div class="controls">
            <div class="controls-row">
                <input type="text" id="startKey" placeholder="Start key (optional)" style="width: 200px;">
                <input type="number" id="limitInput" value="100" min="1" max="10000" style="width: 100px;">
                <button onclick="loadKeys()">Refresh</button>
                <button onclick="openAddModal()" class="success">Add Key</button>
            </div>
            <div class="controls-row">
                <input type="text" id="searchKey" placeholder="Search for specific key" style="width: 300px;">
                <button onclick="searchKey()">Search</button>
                <button onclick="testConnection()">Test Connection</button>
            </div>
        </div>
        
        <!-- Filters Section -->
        <div class="filters-section">
            <div class="filter-row">
                <label><strong>Sort by:</strong></label>
                <select id="sortBy" class="sort-select" onchange="applySorting()">
                    <option value="key">Key (A-Z)</option>
                    <option value="key-desc">Key (Z-A)</option>
                    <option value="size">Value Size (Small to Large)</option>
                    <option value="size-desc">Value Size (Large to Small)</option>
                    <option value="duplicates">Show Duplicates First</option>
                </select>
                
                <label><strong>Filter:</strong></label>
                <select id="filterType" class="sort-select" onchange="applyFilter()">
                    <option value="all">Show All</option>
                    <option value="duplicates">Only Duplicates</option>
                    <option value="unique">Only Unique</option>
                    <option value="binary">Only Binary</option>
                    <option value="text">Only Text</option>
                </select>
                
                <label><strong>Group duplicates:</strong></label>
                <input type="checkbox" id="groupDuplicates" onchange="displayCurrentData()" checked>
            </div>
            <div class="filter-row">
                <label><strong>Items per page:</strong></label>
                <select id="itemsPerPage" class="sort-select" onchange="changePage(1)">
                    <option value="25">25</option>
                    <option value="50" selected>50</option>
                    <option value="100">100</option>
                    <option value="500">500</option>
                    <option value="-1">All</option>
                </select>
            </div>
        </div>
        
        <!-- Data Table Section -->
        <div class="data-section">
            <div class="section-header">
                <h2>Key-Value Pairs</h2>
                <div class="stats">
                    <span id="countStats">0 items</span>
                    <span id="connectionStats">Disconnected</span>
                </div>
            </div>
            
            <div id="loadingIndicator" class="loading">
                Loading...
            </div>
            
            <div id="errorDisplay" class="error" style="display: none;"></div>
            <div id="successDisplay" class="success" style="display: none;"></div>
            
            <div class="table-container">
                <table id="dataTable" style="display: none;">
                    <thead>
                        <tr>
                            <th>Key</th>
                            <th>Value</th>
                            <th>Length</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                    </tbody>
                </table>
            </div>
            
            <!-- Pagination Section -->
            <div class="pagination" id="pagination" style="display: none;">
                <div class="pagination-info" id="paginationInfo"></div>
                <div class="pagination-controls">
                    <button class="pagination-btn" id="prevBtn" onclick="changePage(currentPage - 1)">‚Üê Prev</button>
                    <span id="pageNumbers"></span>
                    <button class="pagination-btn" id="nextBtn" onclick="changePage(currentPage + 1)">Next ‚Üí</button>
                </div>
            </div>
        </div>
        </div>
        
        <!-- Clear Data Tab -->
        <div id="clearTab" class="tab-content">
            <div class="clear-data-container">
                <div class="warning-section">
                    <h2>‚ö†Ô∏è Clear All Data</h2>
                    <p class="warning-text">This action will permanently delete ALL key-value pairs from the database.</p>
                </div>
                
                <div class="clear-info-section">
                    <h3>Before proceeding:</h3>
                    <ul class="clear-checklist">
                        <li>Ensure you have a backup if needed</li>
                        <li>Confirm this is the correct database</li>
                        <li>Verify no critical processes are running</li>
                        <li>Understand this action cannot be undone</li>
                    </ul>
                </div>
                
                <div class="clear-action-section">
                    <button class="danger-button large" onclick="openClearAllModal()">
                        üóëÔ∏è Clear All Data
                    </button>
                    <p class="clear-note">This will open a confirmation dialog with additional safety checks.</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add/Edit Modal -->
    <div id="addModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Add Key-Value Pair</h3>
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            <div class="form-group">
                <label for="modalKey">Key:</label>
                <input type="text" id="modalKey" required>
            </div>
            <div class="form-group">
                <label for="modalValue">Value:</label>
                <textarea id="modalValue" required></textarea>
            </div>
            <div style="text-align: right;">
                <button onclick="closeModal()" style="background-color: #95a5a6;">Cancel</button>
                <button onclick="saveKeyValue()" class="success">Save</button>
            </div>
        </div>
    </div>
    
    <!-- Value Viewer Modal -->
    <div id="viewModal" class="modal">
        <div class="modal-content viewer-modal">
            <div class="modal-header">
                <h3 id="viewModalTitle">View Value</h3>
                <span class="close" onclick="closeViewModal()">&times;</span>
            </div>
            <div class="view-mode-tabs">
                <button class="view-mode-tab active" onclick="switchViewMode('text')">Text</button>
                <button class="view-mode-tab" onclick="switchViewMode('hex')">Hex</button>
                <button class="view-mode-tab" onclick="switchViewMode('raw')">Raw Bytes</button>
            </div>
            <div id="textView" class="view-content active">
                <div class="raw-view" id="textContent"></div>
            </div>
            <div id="hexView" class="view-content">
                <div class="hex-view" id="hexContent"></div>
            </div>
            <div id="rawView" class="view-content">
                <div class="raw-view" id="rawContent"></div>
            </div>
        </div>
    </div>
    
    <!-- Clear All Confirmation Modal -->
    <div id="clearAllModal" class="modal confirmation-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 style="color: #e53e3e;">‚ö†Ô∏è DANGER: Clear All Data</h3>
                <span class="close" onclick="closeClearAllModal()">&times;</span>
            </div>
            
            <div class="confirmation-step">
                <h4>This action will:</h4>
                <ul>
                    <li>Delete ALL key-value pairs in the database</li>
                    <li>Cannot be undone or recovered</li>
                    <li>May take several minutes for large datasets</li>
                </ul>
            </div>
            
            <div class="confirmation-step">
                <h4>Before proceeding:</h4>
                <ol>
                    <li>Ensure you have a backup if needed</li>
                    <li>Confirm this is the correct database</li>
                    <li>Verify no critical processes are running</li>
                </ol>
            </div>
            
            <div class="confirmation-step">
                <p><strong>Type "DELETE ALL DATA" to confirm:</strong></p>
                <input type="text" id="clearAllConfirmation" class="confirmation-input" placeholder="Type confirmation phrase here">
                <p id="clearAllStatus" style="margin-top: 10px; font-weight: bold;"></p>
            </div>
            
            <div style="text-align: right; margin-top: 20px;">
                <button onclick="closeClearAllModal()" style="background-color: #95a5a6; margin-right: 10px;">Cancel</button>
                <button id="clearAllExecute" onclick="executeClearAll()" class="danger-button" disabled>
                    Clear All Data
                </button>
            </div>
        </div>
    </div>
    
    <!-- JavaScript Modules -->
    <script src="app.js?v=key-decode-fix"></script>
    <script src="data-analysis.js?v=key-decode-fix"></script>
    <script src="display.js?v=key-decode-fix"></script>
    <script src="pagination.js"></script>
    <script src="modals.js"></script>
</body>
</html>